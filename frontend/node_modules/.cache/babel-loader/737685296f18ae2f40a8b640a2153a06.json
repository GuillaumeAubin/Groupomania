{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\aubin\\\\Desktop\\\\OpenClassrooms\\\\Groupomania\\\\frontend\\\\src\\\\pages\\\\Forum.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useCallback, useState, useContext } from 'react';\nimport Axios from \"axios\";\nimport '../style/forum.css'; // import DropdownDelMod from '../components/DropdownDelMod'\n\nimport Modal from '../components/Modal';\nimport CommentSection from '../components/CommentSection';\nimport DataContext from '../DataContext';\nimport { useHistory } from \"react-router-dom\";\nimport FormData from 'form-data';\nimport ModifyModal from '../components/ModifyModal';\nimport { FaPlus } from 'react-icons/fa';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Forum() {\n  _s();\n\n  const history = useHistory();\n  const {\n    dataUser,\n    LStoken\n  } = useContext(DataContext); // const { dataUser, LStoken, dataUserId } = useContext(DataContext)\n\n  const [title, setTitle] = useState('');\n  const [content, setContent] = useState('');\n  const [posts, setPosts] = useState([]); // const [isOpen, setIsOpen] = useState(true)\n\n  const [isOpenModal, setIsOpenModal] = useState(false);\n  const [isOpenModifyModal, setIsOpenModifyModal] = useState(false);\n  const [modifyPostId, setModifyPostId] = useState(''); ///\n\n  const [file, setFile] = useState('');\n  const userId = dataUser.id;\n\n  function getPostId(postId) {\n    setModifyPostId(postId);\n    console.log(modifyPostId);\n  }\n\n  function openModify() {\n    setIsOpenModifyModal(true);\n  } // redirection if user is not logged //\n\n\n  function redirectLogin() {\n    history.push(\"/login\");\n  }\n\n  useEffect(() => {\n    if (!LStoken) {\n      redirectLogin();\n    }\n  }, [LStoken]); /////////////////////////////////////\n\n  const fetchPosts = useCallback(() => {\n    Axios.get('http://localhost:4200/api/post', {\n      headers: {\n        Authorization: LStoken\n      }\n    }).then(response => {\n      setPosts(response.data);\n    });\n  }, [LStoken, posts]); ///////////////////////////////////\n\n  const submitPost = useCallback(() => {\n    const userName = dataUser.name;\n    const userId = dataUser.id; // formData auqul on ajoute un fichier + tout les champs text\n\n    const myformData = new FormData();\n    myformData.append(\"title\", title);\n    myformData.append(\"content\", content);\n    myformData.append(\"userId\", userId);\n    myformData.append(\"userName\", userName); // ajouter champ moderator\n\n    myformData.append(\"file\", file);\n    Axios.post(\"http://localhost:4200/api/post\", myformData, {\n      headers: {\n        'Content-Type': 'multipart/form-data',\n        'Authorization': LStoken\n      }\n    }).then(res => console.log(res));\n    setIsOpenModal(!isOpenModal); // refresh page after submit\n\n    window.location.reload();\n    setPosts([...posts, {\n      title: title,\n      content: content,\n      image: file\n    }]);\n  }, [content, title, file, userId, posts, LStoken, isOpenModal]); ///////////////////////////////////\n\n  useEffect(() => {\n    fetchPosts();\n  }, []); ///////////////////////////////////\n\n  const modifyPost = useCallback(() => {\n    const userName = dataUser.name;\n    const userId = dataUser.id;\n    const myformData = new FormData();\n    myformData.append(\"title\", title);\n    myformData.append(\"content\", content);\n    myformData.append(\"userId\", userId);\n    myformData.append(\"userName\", userName);\n    myformData.append(\"file\", file); //Axios.post(\"http://localhost:4200/api/post\", myformData,\n    //Axios.put('https://httpbin.org/anything' , myFormData,\n\n    Axios.put(`http://localhost:4200/api/post/${modifyPostId}`, myformData, {\n      headers: {\n        'Authorization': LStoken\n      }\n    }).then(res => console.log(res));\n    setIsOpenModal(!isOpenModal); // refresh page after submit\n\n    window.location.reload();\n    setPosts([...posts, {\n      title: title,\n      content: content,\n      image: file\n    }]);\n  }, [content, title, file, userId, posts, LStoken, isOpenModal]); ///////////////////////////////////\n\n  const deletePost = id => {\n    //   const deletePost = (id, userId) => {\n    Axios.delete(`http://localhost:4200/api/post/${id}`, {\n      headers: {\n        Authorization: LStoken\n      }\n    });\n    const newPosts = posts.filter(post => post.id !== id);\n    setPosts(newPosts);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"forum-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"hidden-h1\",\n      children: \"Forum\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn upload\",\n      onClick: () => setIsOpenModal(true),\n      children: [/*#__PURE__*/_jsxDEV(FaPlus, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 77\n      }, this), \"Upload\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      open: isOpenModal,\n      onClose: () => setIsOpenModal(false),\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"input-file\",\n        placeholder: \"file\",\n        name: \"file\",\n        type: \"file\",\n        accept: \".jpg\",\n        onChange: e => {\n          const file = e.target.files[0];\n          setFile(file);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"input-title\",\n        placeholder: \"title\",\n        name: \"title\",\n        type: \"text\",\n        onChange: e => {\n          setTitle(e.target.value);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n        className: \"input-content\",\n        placeholder: \"post\",\n        name: \"content\",\n        type: \"text\",\n        onChange: e => {\n          setContent(e.target.value);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"submit-btn\",\n        onClick: submitPost,\n        children: \"SUBMIT\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(ModifyModal, {\n      openModify: isOpenModifyModal,\n      onClose: () => setIsOpenModifyModal(false),\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"input-file\",\n        placeholder: \"file\",\n        name: \"file\",\n        type: \"file\",\n        accept: \".jpg\",\n        onChange: e => {\n          const file = e.target.files[0];\n          setFile(file);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"input-title\",\n        placeholder: \"title\",\n        name: \"title\",\n        type: \"text\",\n        onChange: e => {\n          setTitle(e.target.value);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n        className: \"input-content\",\n        placeholder: \"post\",\n        name: \"content\",\n        type: \"text\",\n        onChange: e => {\n          setContent(e.target.value);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"submit-btn\",\n        onClick: modifyPost,\n        children: \"MODIFY\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 9\n    }, this), posts.map(post => {\n      //{posts.map((post, ofUser) => {\n      const postId = post.id;\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"forum-card\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card-title-box\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: [post.title, \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 208,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"created-by-tag-laptop\",\n            children: [\"post cr\\xE9\\xE9 par \", post.userName]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 209,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"created-by-tag-smartphone\",\n          children: [\"post cr\\xE9\\xE9 par \", post.userName]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card-body\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            className: \"post-img\",\n            src: `${post.imageUrl}`,\n            alt: \"\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"container-buttons\",\n            children: post.userId == userId || dataUser.moderator == true ? /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"delete-btn\",\n                onClick: () => {\n                  deletePost(post.id, post.userId);\n                },\n                children: \"DELETE\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 221,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"modify-btn\",\n                onClick: () => {\n                  openModify();\n                  getPostId(postId);\n                },\n                children: \"MODIFY\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 222,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 220,\n              columnNumber: 33\n            }, this) : null\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 216,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [post.content, \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"container-DropdownDelMod\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"container-comments\",\n            children: /*#__PURE__*/_jsxDEV(CommentSection, {\n              postId: post.id\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 239,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 237,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 25\n        }, this)]\n      }, post.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 17\n      }, this);\n    })]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 155,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Forum, \"F4DHFTwGTdA114N82qTAp0qk8Qg=\", false, function () {\n  return [useHistory];\n});\n\n_c = Forum;\n\nvar _c;\n\n$RefreshReg$(_c, \"Forum\");","map":{"version":3,"sources":["C:/Users/aubin/Desktop/OpenClassrooms/Groupomania/frontend/src/pages/Forum.js"],"names":["React","useEffect","useCallback","useState","useContext","Axios","Modal","CommentSection","DataContext","useHistory","FormData","ModifyModal","FaPlus","Forum","history","dataUser","LStoken","title","setTitle","content","setContent","posts","setPosts","isOpenModal","setIsOpenModal","isOpenModifyModal","setIsOpenModifyModal","modifyPostId","setModifyPostId","file","setFile","userId","id","getPostId","postId","console","log","openModify","redirectLogin","push","fetchPosts","get","headers","Authorization","then","response","data","submitPost","userName","name","myformData","append","post","res","window","location","reload","image","modifyPost","put","deletePost","delete","newPosts","filter","e","target","files","value","map","imageUrl","moderator"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback, useState, useContext } from 'react';\nimport Axios from \"axios\";\nimport '../style/forum.css'\n// import DropdownDelMod from '../components/DropdownDelMod'\nimport Modal from '../components/Modal'\nimport CommentSection from '../components/CommentSection';\nimport DataContext from '../DataContext'\nimport { useHistory } from \"react-router-dom\";\nimport FormData from 'form-data'\nimport ModifyModal from '../components/ModifyModal';\nimport { FaPlus } from 'react-icons/fa';\n\nexport default function Forum() {\n\nconst history = useHistory();\n\nconst { dataUser, LStoken } = useContext(DataContext)\n// const { dataUser, LStoken, dataUserId } = useContext(DataContext)\nconst [title, setTitle] = useState('');\nconst [content, setContent] = useState('');\nconst [posts, setPosts] = useState([])\n// const [isOpen, setIsOpen] = useState(true)\nconst [isOpenModal, setIsOpenModal] = useState(false)\nconst [isOpenModifyModal, setIsOpenModifyModal] = useState(false)\nconst [modifyPostId, setModifyPostId] = useState('')\n///\nconst [file, setFile] = useState('')\n\nconst userId = dataUser.id\n\n\nfunction getPostId(postId) {\n    setModifyPostId(postId)\n    console.log(modifyPostId)\n}\n\nfunction openModify() {\n    setIsOpenModifyModal(true)\n}\n\n\n// redirection if user is not logged //\nfunction redirectLogin() {\n    history.push(\"/login\")\n}\n\nuseEffect(() => {\n    if (!LStoken) {\n        redirectLogin()\n    }\n}, [LStoken])\n\n/////////////////////////////////////\nconst fetchPosts = useCallback(() => {\n    Axios.get('http://localhost:4200/api/post',\n        {\n            headers: {\n                Authorization: LStoken\n            }\n        })\n        .then((response) => {\n            setPosts(response.data)\n        })\n\n\n}, [LStoken, posts])\n\n///////////////////////////////////\n\n\nconst submitPost = useCallback(() => {\n\n    const userName = dataUser.name\n    const userId = dataUser.id\n    // formData auqul on ajoute un fichier + tout les champs text\n    const myformData = new FormData();\n    myformData.append(\"title\", title)\n    myformData.append(\"content\", content)\n    myformData.append(\"userId\", userId)\n    myformData.append(\"userName\", userName)\n    // ajouter champ moderator\n    myformData.append(\"file\", file)\n\n    Axios.post(\"http://localhost:4200/api/post\", myformData,\n        {\n            headers: {\n                'Content-Type': 'multipart/form-data',\n                'Authorization': LStoken\n            }\n        }\n    )\n        .then(res => console.log(res))\n    setIsOpenModal(!isOpenModal)\n    // refresh page after submit\n    window.location.reload();\n    setPosts([...posts, { title: title, content: content, image: file }])\n}, [content, title, file, userId, posts, LStoken, isOpenModal])\n\n\n///////////////////////////////////\n\nuseEffect(() => {\n    fetchPosts();\n}, []);\n\n///////////////////////////////////\n\n\nconst modifyPost = useCallback(() => {\n\n\n    const userName = dataUser.name\n    const userId = dataUser.id\n    const myformData = new FormData();\n    myformData.append(\"title\", title)\n    myformData.append(\"content\", content)\n    myformData.append(\"userId\", userId)\n    myformData.append(\"userName\", userName)\n    myformData.append(\"file\", file)\n\n    //Axios.post(\"http://localhost:4200/api/post\", myformData,\n    //Axios.put('https://httpbin.org/anything' , myFormData,\n    Axios.put(`http://localhost:4200/api/post/${modifyPostId}`, myformData,\n        {\n            headers: {\n                'Authorization': LStoken\n            }\n        }\n    )\n        .then(res => console.log(res))\n    setIsOpenModal(!isOpenModal)\n    // refresh page after submit\n    window.location.reload();\n    setPosts([...posts, { title: title, content: content, image: file }])\n}, [content, title, file, userId, posts, LStoken, isOpenModal])\n\n///////////////////////////////////\n\n\nconst deletePost = (id) => {\n    //   const deletePost = (id, userId) => {\n    Axios.delete(`http://localhost:4200/api/post/${id}`,\n        {\n            headers: {\n                Authorization: LStoken\n            }\n        }\n    )\n    const newPosts = posts.filter((post) => post.id !== id);\n    setPosts(newPosts)\n}\n\n\nreturn (\n    <div className=\"forum-container\">\n        <h1 className=\"hidden-h1\">Forum</h1>\n\n        <button className=\"btn upload\" onClick={() => setIsOpenModal(true)}><FaPlus />Upload</button>\n        <Modal open={isOpenModal} onClose={() => setIsOpenModal(false)}>\n            <input className=\"input-file\" placeholder=\"file\" name=\"file\" type=\"file\" accept=\".jpg\"\n                onChange={(e) => {\n                    const file = e.target.files[0]\n                    setFile(file)\n                }}\n            ></input>\n            <input className=\"input-title\" placeholder=\"title\" name=\"title\" type=\"text\"\n                onChange={(e) => {\n                    setTitle(e.target.value)\n                }}\n            ></input>\n            <textarea className=\"input-content\" placeholder=\"post\" name=\"content\" type=\"text\"\n                onChange={(e) => {\n                    setContent(e.target.value)\n                }}></textarea>\n            <button className=\"submit-btn\" onClick={submitPost}>SUBMIT</button>\n        </Modal>\n\n\n\n        <ModifyModal openModify={isOpenModifyModal} onClose={() => setIsOpenModifyModal(false)}>\n            <input className=\"input-file\" placeholder=\"file\" name=\"file\" type=\"file\" accept=\".jpg\"\n                onChange={(e) => {\n                    const file = e.target.files[0]\n                    setFile(file)\n                }}\n            ></input>\n            <input className=\"input-title\" placeholder=\"title\" name=\"title\" type=\"text\"\n                onChange={(e) => {\n                    setTitle(e.target.value)\n                }}\n            ></input>\n            <textarea className=\"input-content\" placeholder=\"post\" name=\"content\" type=\"text\"\n                onChange={(e) => {\n                    setContent(e.target.value)\n                }}></textarea>\n            <button className=\"submit-btn\" onClick={modifyPost}>MODIFY</button>\n        </ModifyModal>\n\n\n\n        {posts.map((post) => {\n            //{posts.map((post, ofUser) => {\n            const postId = post.id\n\n            return (\n                <div key={post.id} className=\"forum-card\">\n                    <div className=\"card-title-box\">\n                        <h2>{post.title} </h2>\n                        <p className=\"created-by-tag-laptop\">post créé par {post.userName}</p>\n\n                    </div>\n                    <p className=\"created-by-tag-smartphone\">post créé par {post.userName}</p>\n                    <div className=\"card-body\">\n\n                        <img className=\"post-img\" src={`${post.imageUrl}`} alt='' />\n                        <div className=\"container-buttons\">\n\n                            {post.userId == userId || dataUser.moderator == true ?\n\n                                <div>\n                                    <button className=\"delete-btn\" onClick={() => { deletePost(post.id, post.userId) }} >DELETE</button>\n                                    <button className=\"modify-btn\" onClick={() => { openModify(); getPostId(postId); }}>MODIFY</button>\n                                </div>\n\n                                : null}\n\n                        </div>\n\n                    </div>\n\n                    <p>{post.content} </p>\n\n                   {/* // <DropdownDelMod open={isOpen} postId={post.id} > */}\n\n                        <div className=\"container-DropdownDelMod\">\n\n                            <div className=\"container-comments\">\n\n                                <CommentSection postId={post.id} />\n\n                            </div>\n\n                        </div>\n{/* \n                   // </DropdownDelMod> */}\n                </div>\n            )\n        }\n        )}\n    </div>\n\n)\n\n\n\n}"]},"metadata":{},"sourceType":"module"}