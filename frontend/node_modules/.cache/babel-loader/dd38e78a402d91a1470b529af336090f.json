{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\aubin\\\\Desktop\\\\OpenClassrooms\\\\Groupomania\\\\frontend\\\\src\\\\pages\\\\Forum.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useCallback, useState, useContext } from \"react\";\nimport Axios from \"axios\";\nimport \"../style/forum.css\"; // import DropdownDelMod from '../components/DropdownDelMod'\n\nimport Modal from \"../components/Modal\";\nimport CommentSection from \"../components/CommentSection\";\nimport DataContext from \"../DataContext\";\nimport { useHistory } from \"react-router-dom\";\nimport FormData from \"form-data\";\nimport ModifyModal from \"../components/ModifyModal\";\nimport { FaPlus } from \"react-icons/fa\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Forum() {\n  _s();\n\n  const history = useHistory();\n  const {\n    dataUser,\n    LStoken\n  } = useContext(DataContext); // const { dataUser, LStoken, dataUserId } = useContext(DataContext)\n\n  const [title, setTitle] = useState(\"\");\n  const [content, setContent] = useState(\"\");\n  const [posts, setPosts] = useState([]); // const [isOpen, setIsOpen] = useState(true)\n\n  const [isOpenModal, setIsOpenModal] = useState(false);\n  const [isOpenModifyModal, setIsOpenModifyModal] = useState(false);\n  const [modifyPostId, setModifyPostId] = useState(\"\"); ///\n\n  const [file, setFile] = useState(\"\");\n  const userId = dataUser.id;\n\n  function getPostId(postId) {\n    setModifyPostId(postId);\n    console.log(modifyPostId);\n  }\n\n  function openModify() {\n    setIsOpenModifyModal(true);\n  } // redirection if user is not logged //\n\n\n  function redirectLogin() {\n    history.push(\"/login\");\n  }\n\n  useEffect(() => {\n    if (!LStoken) {\n      redirectLogin();\n    }\n  }, [LStoken]); /////////////////////////////////////\n\n  const fetchPosts = useCallback(() => {\n    Axios.get(\"http://localhost:4200/api/post\", {\n      headers: {\n        Authorization: LStoken\n      }\n    }).then(response => {\n      setPosts(response.data);\n    });\n  }, [LStoken, posts]); ///////////////////////////////////\n\n  const submitPost = useCallback(() => {\n    const userName = dataUser.name;\n    const userId = dataUser.id; // formData auqul on ajoute un fichier + tout les champs text\n\n    const myformData = new FormData();\n    myformData.append(\"title\", title);\n    myformData.append(\"content\", content);\n    myformData.append(\"userId\", userId);\n    myformData.append(\"userName\", userName); // ajouter champ moderator\n\n    myformData.append(\"file\", file);\n    Axios.post(\"http://localhost:4200/api/post\", myformData, {\n      headers: {\n        \"Content-Type\": \"multipart/form-data\",\n        Authorization: LStoken\n      }\n    }).then(res => console.log(res));\n    setIsOpenModal(!isOpenModal); // refresh page after submit\n\n    window.location.reload();\n    setPosts([...posts, {\n      title: title,\n      content: content,\n      image: file\n    }]);\n  }, [content, title, file, userId, posts, LStoken, isOpenModal]); ///////////////////////////////////\n\n  useEffect(() => {\n    fetchPosts();\n  }, []); ///////////////////////////////////\n\n  const modifyPost = useCallback(() => {\n    const userName = dataUser.name;\n    const userId = dataUser.id;\n    const myformData = new FormData();\n    myformData.append(\"title\", title);\n    myformData.append(\"content\", content);\n    myformData.append(\"userId\", userId);\n    myformData.append(\"userName\", userName);\n    myformData.append(\"file\", file); //Axios.post(\"http://localhost:4200/api/post\", myformData,\n    //Axios.put('https://httpbin.org/anything' , myFormData,\n\n    Axios.put(`http://localhost:4200/api/post/${modifyPostId}`, myformData, {\n      headers: {\n        Authorization: LStoken\n      }\n    }).then(res => console.log(res));\n    setIsOpenModal(!isOpenModal); // refresh page after submit\n\n    window.location.reload();\n    setPosts([...posts, {\n      title: title,\n      content: content,\n      image: file\n    }]);\n  }, [content, title, file, userId, posts, LStoken, isOpenModal]); ///////////////////////////////////\n\n  const deletePost = id => {\n    //   const deletePost = (id, userId) => {\n    Axios.delete(`http://localhost:4200/api/post/${id}`, {\n      headers: {\n        Authorization: LStoken\n      }\n    });\n    const newPosts = posts.filter(post => post.id !== id);\n    setPosts(newPosts);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"forum-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"hidden-h1\",\n      children: \"Forum\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn upload\",\n      onClick: () => setIsOpenModal(true),\n      children: [/*#__PURE__*/_jsxDEV(FaPlus, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 9\n      }, this), \"Upload\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      open: isOpenModal,\n      onClose: () => setIsOpenModal(false),\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"input-file\",\n        placeholder: \"file\",\n        name: \"file\",\n        type: \"file\",\n        accept: \".jpg\",\n        onChange: e => {\n          const file = e.target.files[0];\n          setFile(file);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"input-title\",\n        placeholder: \"title\",\n        name: \"title\",\n        type: \"text\",\n        onChange: e => {\n          setTitle(e.target.value);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n        className: \"input-content\",\n        placeholder: \"post\",\n        name: \"content\",\n        type: \"text\",\n        onChange: e => {\n          setContent(e.target.value);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"submit-btn\",\n        onClick: submitPost,\n        children: \"SUBMIT\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ModifyModal, {\n      openModify: isOpenModifyModal,\n      onClose: () => setIsOpenModifyModal(false),\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"input-file\",\n        placeholder: \"file\",\n        name: \"file\",\n        type: \"file\",\n        accept: \".jpg\",\n        onChange: e => {\n          const file = e.target.files[0];\n          setFile(file);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"input-title\",\n        placeholder: \"title\",\n        name: \"title\",\n        type: \"text\",\n        onChange: e => {\n          setTitle(e.target.value);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n        className: \"input-content\",\n        placeholder: \"post\",\n        name: \"content\",\n        type: \"text\",\n        onChange: e => {\n          setContent(e.target.value);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"submit-btn\",\n        onClick: modifyPost,\n        children: \"MODIFY\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 7\n    }, this), posts.map(post => {\n      //{posts.map((post, ofUser) => {\n      const postId = post.id;\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"forum-card\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card-title-box\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: [post.title, \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 219,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"created-by-tag-laptop\",\n            children: [\"post cr\\xE9\\xE9 par \", post.userName]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 220,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"created-by-tag-smartphone\",\n          children: [\"post cr\\xE9\\xE9 par \", post.userName]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card-body\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            className: \"post-img\",\n            src: `${post.imageUrl}`,\n            alt: \"\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 228,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"container-buttons\",\n            children: post.userId == userId || dataUser.moderator == true ? /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"delete-btn\",\n                onClick: () => {\n                  deletePost(post.id, post.userId);\n                },\n                children: \"DELETE\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 232,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"modify-btn\",\n                onClick: () => {\n                  openModify();\n                  getPostId(postId);\n                },\n                children: \"MODIFY\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 240,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 231,\n              columnNumber: 19\n            }, this) : null\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 229,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [post.content, \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"container-DropdownDelMod\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"container-comments\",\n            children: /*#__PURE__*/_jsxDEV(CommentSection, {\n              postId: post.id\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 260,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 13\n        }, this)]\n      }, post.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 11\n      }, this);\n    })]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 132,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Forum, \"RZkYfkdAhvUMkqDoLP3qJb0lC/c=\", false, function () {\n  return [useHistory];\n});\n\n_c = Forum;\n\nvar _c;\n\n$RefreshReg$(_c, \"Forum\");","map":{"version":3,"sources":["C:/Users/aubin/Desktop/OpenClassrooms/Groupomania/frontend/src/pages/Forum.js"],"names":["React","useEffect","useCallback","useState","useContext","Axios","Modal","CommentSection","DataContext","useHistory","FormData","ModifyModal","FaPlus","Forum","history","dataUser","LStoken","title","setTitle","content","setContent","posts","setPosts","isOpenModal","setIsOpenModal","isOpenModifyModal","setIsOpenModifyModal","modifyPostId","setModifyPostId","file","setFile","userId","id","getPostId","postId","console","log","openModify","redirectLogin","push","fetchPosts","get","headers","Authorization","then","response","data","submitPost","userName","name","myformData","append","post","res","window","location","reload","image","modifyPost","put","deletePost","delete","newPosts","filter","e","target","files","value","map","imageUrl","moderator"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback, useState, useContext } from \"react\";\nimport Axios from \"axios\";\nimport \"../style/forum.css\";\n// import DropdownDelMod from '../components/DropdownDelMod'\nimport Modal from \"../components/Modal\";\nimport CommentSection from \"../components/CommentSection\";\nimport DataContext from \"../DataContext\";\nimport { useHistory } from \"react-router-dom\";\nimport FormData from \"form-data\";\nimport ModifyModal from \"../components/ModifyModal\";\nimport { FaPlus } from \"react-icons/fa\";\n\nexport default function Forum() {\n  const history = useHistory();\n\n  const { dataUser, LStoken } = useContext(DataContext);\n  // const { dataUser, LStoken, dataUserId } = useContext(DataContext)\n  const [title, setTitle] = useState(\"\");\n  const [content, setContent] = useState(\"\");\n  const [posts, setPosts] = useState([]);\n  // const [isOpen, setIsOpen] = useState(true)\n  const [isOpenModal, setIsOpenModal] = useState(false);\n  const [isOpenModifyModal, setIsOpenModifyModal] = useState(false);\n  const [modifyPostId, setModifyPostId] = useState(\"\");\n  ///\n  const [file, setFile] = useState(\"\");\n\n  const userId = dataUser.id;\n\n  function getPostId(postId) {\n    setModifyPostId(postId);\n    console.log(modifyPostId);\n  }\n\n  function openModify() {\n    setIsOpenModifyModal(true);\n  }\n\n  // redirection if user is not logged //\n  function redirectLogin() {\n    history.push(\"/login\");\n  }\n\n  useEffect(() => {\n    if (!LStoken) {\n      redirectLogin();\n    }\n  }, [LStoken]);\n\n  /////////////////////////////////////\n  const fetchPosts = useCallback(() => {\n    Axios.get(\"http://localhost:4200/api/post\", {\n      headers: {\n        Authorization: LStoken,\n      },\n    }).then((response) => {\n      setPosts(response.data);\n    });\n  }, [LStoken, posts]);\n\n  ///////////////////////////////////\n\n  const submitPost = useCallback(() => {\n    const userName = dataUser.name;\n    const userId = dataUser.id;\n    // formData auqul on ajoute un fichier + tout les champs text\n    const myformData = new FormData();\n    myformData.append(\"title\", title);\n    myformData.append(\"content\", content);\n    myformData.append(\"userId\", userId);\n    myformData.append(\"userName\", userName);\n    // ajouter champ moderator\n    myformData.append(\"file\", file);\n\n    Axios.post(\"http://localhost:4200/api/post\", myformData, {\n      headers: {\n        \"Content-Type\": \"multipart/form-data\",\n        Authorization: LStoken,\n      },\n    }).then((res) => console.log(res));\n    setIsOpenModal(!isOpenModal);\n    // refresh page after submit\n    window.location.reload();\n    setPosts([...posts, { title: title, content: content, image: file }]);\n  }, [content, title, file, userId, posts, LStoken, isOpenModal]);\n\n  ///////////////////////////////////\n\n  useEffect(() => {\n    fetchPosts();\n  }, []);\n\n  ///////////////////////////////////\n\n  const modifyPost = useCallback(() => {\n    const userName = dataUser.name;\n    const userId = dataUser.id;\n    const myformData = new FormData();\n    myformData.append(\"title\", title);\n    myformData.append(\"content\", content);\n    myformData.append(\"userId\", userId);\n    myformData.append(\"userName\", userName);\n    myformData.append(\"file\", file);\n\n    //Axios.post(\"http://localhost:4200/api/post\", myformData,\n    //Axios.put('https://httpbin.org/anything' , myFormData,\n    Axios.put(`http://localhost:4200/api/post/${modifyPostId}`, myformData, {\n      headers: {\n        Authorization: LStoken,\n      },\n    }).then((res) => console.log(res));\n    setIsOpenModal(!isOpenModal);\n    // refresh page after submit\n    window.location.reload();\n    setPosts([...posts, { title: title, content: content, image: file }]);\n  }, [content, title, file, userId, posts, LStoken, isOpenModal]);\n\n  ///////////////////////////////////\n\n  const deletePost = (id) => {\n    //   const deletePost = (id, userId) => {\n    Axios.delete(`http://localhost:4200/api/post/${id}`, {\n      headers: {\n        Authorization: LStoken,\n      },\n    });\n    const newPosts = posts.filter((post) => post.id !== id);\n    setPosts(newPosts);\n  };\n\n  return (\n    <div className=\"forum-container\">\n      <h1 className=\"hidden-h1\">Forum</h1>\n\n      <button className=\"btn upload\" onClick={() => setIsOpenModal(true)}>\n        <FaPlus />\n        Upload\n      </button>\n      <Modal open={isOpenModal} onClose={() => setIsOpenModal(false)}>\n        <input\n          className=\"input-file\"\n          placeholder=\"file\"\n          name=\"file\"\n          type=\"file\"\n          accept=\".jpg\"\n          onChange={(e) => {\n            const file = e.target.files[0];\n            setFile(file);\n          }}\n        ></input>\n        <input\n          className=\"input-title\"\n          placeholder=\"title\"\n          name=\"title\"\n          type=\"text\"\n          onChange={(e) => {\n            setTitle(e.target.value);\n          }}\n        ></input>\n        <textarea\n          className=\"input-content\"\n          placeholder=\"post\"\n          name=\"content\"\n          type=\"text\"\n          onChange={(e) => {\n            setContent(e.target.value);\n          }}\n        ></textarea>\n        <button className=\"submit-btn\" onClick={submitPost}>\n          SUBMIT\n        </button>\n      </Modal>\n\n      <ModifyModal\n        openModify={isOpenModifyModal}\n        onClose={() => setIsOpenModifyModal(false)}\n      >\n        <input\n          className=\"input-file\"\n          placeholder=\"file\"\n          name=\"file\"\n          type=\"file\"\n          accept=\".jpg\"\n          onChange={(e) => {\n            const file = e.target.files[0];\n            setFile(file);\n          }}\n        ></input>\n        <input\n          className=\"input-title\"\n          placeholder=\"title\"\n          name=\"title\"\n          type=\"text\"\n          onChange={(e) => {\n            setTitle(e.target.value);\n          }}\n        ></input>\n        <textarea\n          className=\"input-content\"\n          placeholder=\"post\"\n          name=\"content\"\n          type=\"text\"\n          onChange={(e) => {\n            setContent(e.target.value);\n          }}\n        ></textarea>\n        <button className=\"submit-btn\" onClick={modifyPost}>\n          MODIFY\n        </button>\n      </ModifyModal>\n\n      {posts.map((post) => {\n        //{posts.map((post, ofUser) => {\n        const postId = post.id;\n\n        return (\n          <div key={post.id} className=\"forum-card\">\n            <div className=\"card-title-box\">\n              <h2>{post.title} </h2>\n              <p className=\"created-by-tag-laptop\">\n                post créé par {post.userName}\n              </p>\n            </div>\n            <p className=\"created-by-tag-smartphone\">\n              post créé par {post.userName}\n            </p>\n            <div className=\"card-body\">\n              <img className=\"post-img\" src={`${post.imageUrl}`} alt=\"\" />\n              <div className=\"container-buttons\">\n                {post.userId == userId || dataUser.moderator == true ? (\n                  <div>\n                    <button\n                      className=\"delete-btn\"\n                      onClick={() => {\n                        deletePost(post.id, post.userId);\n                      }}\n                    >\n                      DELETE\n                    </button>\n                    <button\n                      className=\"modify-btn\"\n                      onClick={() => {\n                        openModify();\n                        getPostId(postId);\n                      }}\n                    >\n                      MODIFY\n                    </button>\n                  </div>\n                ) : null}\n              </div>\n            </div>\n\n            <p>{post.content} </p>\n\n            {/* // <DropdownDelMod open={isOpen} postId={post.id} > */}\n\n            <div className=\"container-DropdownDelMod\">\n              <div className=\"container-comments\">\n                <CommentSection postId={post.id} />\n              </div>\n            </div>\n            {/* \n                   // </DropdownDelMod> */}\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}